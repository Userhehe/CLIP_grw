<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.gwr.model.mapper.UserDaoImpl">
	<!-- 사원목록 전체조회 -->
	<select id="selectUserinfoList" resultType="UserinfoVo">
		SELECT U.USER_ID, U.USER_NAME, R.RANKS_NAME, 
	        D.DEPT_NAME, PO.POSITIONS_NAME, U.PHOTO_SEQ,
	        U.USER_AUTH, U.USER_REGDATE
		FROM CLIP.USERINFO U
		INNER JOIN CLIP.RANKS R ON U.RANKS_SEQ = R.RANKS_SEQ
		INNER JOIN CLIP.DEPT D ON U.DEPT_SEQ = D.DEPT_SEQ
		INNER JOIN CLIP.POSITIONS PO ON U.POSITIONS_SEQ = PO.POSITIONS_SEQ
		WHERE USER_STATUS = 'Y' 
		ORDER BY USER_REGDATE DESC
	</select>
	
	<!-- 사원정보 등록 -->
	<insert id="insertUserinfo" parameterType="java.util.Map">
		<selectKey keyProperty="user_seq" resultType="java.lang.Integer" order="BEFORE">
			SELECT USER_SEQ.NEXTVAL AS USER_SEQ FROM DUAL
		</selectKey>
		INSERT INTO CLIP.USERINFO
			(USER_ID, USER_NAME, USER_REGISTNUM, 
			USER_PHONENUM, USER_EMAIL, USER_BIRTHDAY, 
			USER_ADDRESS, RANKS_SEQ, DEPT_SEQ, 
			POSITIONS_SEQ, USER_CERTNUM, 
			USER_REGDATE)
			VALUES('USER_' || TO_CHAR(USER_SEQ.NEXTVAL, 'FM000'), #{user_name}, #{user_registnum},
			#{user_phonenum}, #{user_email}, #{user_birthday}, 
			#{user_address},
			(SELECT RANKS_SEQ FROM RANKS WHERE RANKS_NAME = #{ranks_name}),
			(SELECT DEPT_SEQ FROM DEPT WHERE DEPT_NAME = #{dept_name}),
			(SELECT POSITIONS_SEQ FROM POSITIONS WHERE POSITIONS_NAME = #{positions_name}),
			0, TO_CHAR(CURRENT_DATE, 'YYYY-MM-DD'))
	</insert>
	
	<!-- 사원정보 수정 -->
	<insert id="updateUserinfo" parameterType="java.util.Map">
		UPDATE CLIP.USERINFO
			SET USER_NAME = #{user_name}, USER_REGISTNUM = #{user_registnum}, USER_PHONENUM = #{user_phonenum}, 
			USER_EMAIL = #{user_email}, USER_BIRTHDAY = #{user_birthday}, USER_ADDRESS = #{user_address}
			RANKS_SEQ = #{ranks_seq}, DEPT_SEQ = #{dept_seq}, POSITIONS_SEQ = #{positions_seq}, 
			USER_AUTH = 'U' , USER_STATUS = 'N'
			WHERE USER_ID = #{user_id};
	</insert>
	
	
</mapper>
