<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.gwr.model.mapper.RanksDaoImpl">
 
    <!-- 직급 전체 조회 -->
     <select id="ranksAll" resultType="RanksVo">
	 SELECT RANKS_SEQ , RANKS_NAME , RANKS_REGDATE   
	 FROM RANKS  ORDER BY RANKS_SEQ
	</select>
 
	 <!-- 직급등록 -->
	 <insert id="insertRanks" parameterType="java.util.Map">
	 INSERT INTO RANKS
	(RANKS_SEQ, RANKS_NAME, RANKS_REGDATE)
	VALUES('RANKS_' || TO_CHAR(RANKS_SEQ.NEXTVAL, 'FM000'), #{ranks_name}, SYSTIMESTAMP)
	 </insert>
	 
	 <!-- 직급 수정 -->
	 <update id="updateRanks" parameterType="java.util.Map">
	    UPDATE RANKS R
		SET R.RANKS_NAME = #{ranks_name}
		WHERE R.RANKS_SEQ = #{ranks_seq} 
		AND R.RANKS_SEQ IN (
		    SELECT U.RANKS_SEQ
		    FROM CLIP.USERINFO U)
	 </update>
	 
	 <!-- 직급 삭제 -->
	 <delete id="delRanks" parameterType="java.util.Map">
		 DELETE  FROM  RANKS 
	     WHERE RANKS_SEQ = #{ranks_seq} 
	 </delete>
	 
	 <!-- 직급 검색 -->
	 <select id="searchRanks" parameterType="java.util.Map">
		 SELECT *
	     FROM RANKS r 
	     WHERE 1=1
	 	<if test="dept_name != null">
			AND RANKS_NAME LIKE '%' || #{ranks_name} || '%'
		</if>
		<if test="start_regdate != null and end_regdate != null">
			AND RANKS_REGDATE BETWEEN TO_DATE(#{start_regdate}, 'YYYY-MM-DD') 
			AND TO_DATE(#{end_regdate}, 'YYYY-MM-DD')
		</if>
     </select>
	 
	 <!-- 직급명 중복 검사 -->
	 <select id="duplicateRanks" parameterType="java.util.Map">
		  SELECT COUNT(*)
	      FROM RANKS 
	      WHERE RANKS_NAME  =  #{ranks_name}
	 </select>
</mapper>
