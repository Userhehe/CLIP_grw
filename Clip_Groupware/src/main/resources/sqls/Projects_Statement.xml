<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.grw.model.mapper.ProjectsDaoImpl">

    <!-- 새로운 프로젝트 추가 -->
    <insert id="insertProject" parameterType="Project">
        INSERT INTO PROJECTS (PRJ_ID, CLI_ID, PRJ_NAME, PRJ_SDATE, PRJ_DDATE, PRJ_STATUS, PRJ_MANAGER)
        VALUES (#{projectId}, #{clientId}, #{projectName}, #{startDate}, #{dueDate}, #{status}, #{managerId})
    </insert>

    <!-- 프로젝트 정보 수정 -->
    <update id="updateProject" parameterType="Project">
        UPDATE PROJECTS
        SET CLI_ID = #{clientId},
            PRJ_NAME = #{projectName},
            PRJ_SDATE = #{startDate},
            PRJ_DDATE = #{dueDate},
            PRJ_STATUS = #{status},
            PRJ_MANAGER = #{managerId}
        WHERE PRJ_ID = #{projectId} AND PRJ_STATUS = '진행중'
    </update>

    <!-- 프로젝트 삭제 -->
    <delete id="deleteProject" parameterType="String">
        DELETE FROM PROJECTS WHERE PRJ_ID = #{projectId}
    </delete>

    <!-- 진행중인 프로젝트 조회 -->
    <select id="getOngoingProjects" resultType="Project">
        SELECT * FROM PROJECTS WHERE PRJ_STATUS = '진행중'
    </select>

    <!-- 완료된 프로젝트 조회 -->
    <select id="getCompletedProjects" resultType="Project">
        SELECT * FROM PROJECTS WHERE PRJ_STATUS = '완료'
    </select>

    <!-- 날짜 범위 내 프로젝트 조회 -->
    <select id="getProjectsBetweenDates" resultType="Project" parameterType="Map">
        SELECT * FROM PROJECTS
        WHERE PRJ_SDATE BETWEEN #{startDate} AND #{endDate}
    </select>

    <!-- 클라이언트명으로 프로젝트 조회 -->
    <select id="getProjectsByClientName" resultType="Project" parameterType="String">
        SELECT P.PRJ_NAME, P.PRJ_SDATE, P.PRJ_DDATE, P.PRJ_STATUS
        FROM CLIENT C
        JOIN PROJECTS P ON C.CLI_ID = P.CLI_ID
        WHERE C.CLI_NAME = #{clientName}
    </select>

</mapper>

