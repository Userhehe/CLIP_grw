<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.gwr.model.mapper.ProjectsDaoImpl">


	<!-- 프로젝트 전체조회 -->
	<select id="getProjectsAll" resultType="ProjectsVo">
		SELECT CLI_NAME,
		PRJ_NAME, PRJ_PROGRESS
		FROM PROJECTS p 
	</select>
	
	<!-- 첫번째 탭 : 진행중/완료 목록 조회 -->
	<select id="getProgressProjects" parameterType="java.util.Map" resultType="ProjectsVo">
		SELECT p.PRJ_ID, p.PRJ_NAME,p.CLI_NAME, p.PRJ_SDATE, p.PRJ_DDATE, p.PRJ_STATUS, p.PRJ_MANAGER, p.PRJ_PROGRESS, pm.USER_ID, u.USER_NAME
		FROM PROJECTS p 
		JOIN PROJECT_MEM pm ON p.PRJ_ID = pm.PRJ_ID
		JOIN USERINFO u ON pm.USER_ID = u.USER_ID
		WHERE 1=1
			<if test="PRJ_STATUS != null and PRJ_STATUS != ''">
			AND PRJ_STATUS = #{PRJ_STATUS}
			</if>
			<if test="CLI_NAME != null and CLI_NAME != ''">
			AND CLI_NAME = #{CLI_NAME}
			</if>
			<!-- AND u.USER_ID IN (#{USER_ID}) -->
		ORDER BY p.PRJ_SDATE ASC 
	</select>
	
	<select id="getMemberName" resultType="ProjectMemVo">
		SELECT u.USER_NAME 
		FROM USERINFO u JOIN PROJECT_MEM m
		ON u.USER_ID = m.USER_ID 

	</select>

	<select id="projectsClientSel" resultType="ProjectsVo">
		SELECT PRJ_ID,
		CLI_NAME, PRJ_NAME, PRJ_SDATE, PRJ_DDATE, PRJ_STATUS,
		PRJ_MANAGER,
		PRJ_PROGRESS
		FROM PROJECTS
		WHERE CLI_NAME = #{cli_name}
	</select>

	<!-- 프로젝트 기간별조회 -->
	<select id="projectsPeriodSel" resultType="ProjectsVo">
		SELECT PRJ_ID,
		CLI_NAME, PRJ_NAME, PRJ_SDATE, PRJ_DDATE, PRJ_STATUS,
		PRJ_MANAGER,
		PRJ_PROGRESS
		FROM PROJECTS
		WHERE PRJ_SDATE = #{prj_sdate}
	</select>
	
		<!-- 프로젝트 구성원 입력 -->
	<insert id="pmeminsert" parameterType="java.util.Map">
		INSERT INTO ATTENDS (PRJ_ID, USER_ID, RANKS_NAME, USER_NAME)
			VALUES(
			#{prj_id},#{user_id}, 
			(SELECT RANKS_NAME
					FROM RANKS r 
					JOIN USERINFO u ON r.RANKS_SEQ =u.RANKS_SEQ 
					WHERE u.USER_ID = #{user_id} ),
			(SELECT USER_NAME
					FROM USERINFO
					WHERE USER_ID = #{user_id})	
			)
	</insert>


</mapper>

