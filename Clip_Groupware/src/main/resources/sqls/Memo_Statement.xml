<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.gwr.model.mapper.MemoDaoImpl" >

<!-- 본인 메모 조회 -->
<select id="myScheduleAll" parameterType="java.lang.String" resultType="MemoVo">
	SELECT PRS_SEQ, USER_ID, PRS_TITLE, 
       	   PRS_CONTENT, PRS_START, PRS_END, 
           PRS_CREATE, PRS_DELFLAG
        FROM USER_SCHEDULE
        WHERE USER_ID = #{user_id} AND PRS_DELFLAG = 'N'
        AND (PRS_START BETWEEN TO_DATE('2024-03-04', 'YYYY-MM-DD') AND TO_DATE('2024-03-28', 'YYYY-MM-DD')
        OR PRS_END BETWEEN TO_DATE('2024-03-04', 'YYYY-MM-DD') AND TO_DATE('2024-03-29', 'YYYY-MM-DD'))
</select >

<!-- 선택메모 상세조회 -->
<select id="myScheduleDetail" parameterType="java.lang.String" resultType="MemoVo">
	SELECT PRS_SEQ, USER_ID, PRS_TITLE, 
       	   PRS_CONTENT, TO_CHAR(PRS_START, 'YYYY-MM-DD HH24:MI') AS PRS_START, TO_CHAR(PRS_END, 'YYYY-MM-DD HH24:MI') AS PRS_END, 
           PRS_CREATE, PRS_DELFLAG    
        FROM USER_SCHEDULE
        WHERE PRS_SEQ = #{prs_seq} 
</select>



<!-- 메모 입력 -->
<insert id="myScheduleInsert" parameterType="MemoVo" >
	INSERT INTO USER_SCHEDULE(PRS_SEQ, USER_ID, PRS_TITLE, 
                              PRS_CONTENT, PRS_START, PRS_END, 
                              PRS_CREATE)
        VALUES('USERSCHEDULE_' || TO_CHAR(USERSCHEDULE_SEQ.NEXTVAL, 'FM000'), #{user_id}, #{prs_title}, 
               #{prs_content}, TO_DATE(#{prs_start}, 'YYYY-MM-DD HH24:MI'), TO_DATE(#{prs_end}, 'YYYY-MM-DD HH24:MI'), 
               TO_DATE(SYSDATE, 'YYYY-MM-DD HH24:MI'))
</insert>

<!-- 개인 메모 삭제 -->
<delete id="myScheduleDelete" parameterType="java.lang.String">
	DELETE FROM USER_SCHEDULE
		WHERE PRS_SEQ=#{prs_seq}
</delete>

<!-- 개인 메모 수정 -->
<update id="myScheduleUpdate" parameterType="java.util.Map">
	UPDATE USER_SCHEDULE
		SET PRS_TITLE=#{prs_title}, PRS_CONTENT=#{prs_content}, PRS_START=TO_DATE(#{prs_start}, 'YYYY-MM-DD HH24:MI'), 
			PRS_END=TO_DATE(#{prs_end}, 'YYYY-MM-DD HH24:MI'), PRS_CREATE=TO_DATE(SYSDATE, 'YYYY-MM-DD HH24:MI')
		WHERE PRS_SEQ=#{prs_seq}
</update>



<!-- 테스트 용 유니온으로 하는 전사, 개인 일정 조회 -->
<select id="selectScheduleAll" parameterType="java.util.Map" resultType="MemoVo">
	SELECT PRS_SEQ , USER_ID, PRS_TITLE, 
			TO_CHAR(PRS_START, 'YYYY-MM-DD HH24:MI') AS PRS_START, TO_CHAR(PRS_END, 'YYYY-MM-DD HH24:MI') AS PRS_END
			FROM USER_SCHEDULE
			WHERE PRS_DELFLAG = 'N' AND USER_ID = #{user_id}
			AND (TO_CHAR(PRS_START, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
			OR TO_CHAR(PRS_END, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM'))
	UNION 
	SELECT NTC_SEQ, USER_ID, NTC_TITLE, 
			TO_CHAR(NTC_START, 'YYYY-MM-DD HH24:MI') AS NTC_START, TO_CHAR(NTC_END, 'YYYY-MM-DD HH24:MI') AS NTC_END
	        FROM NTC_SCHEDULE
	        WHERE NTC_DELFLAG = 'N'
	       	AND (TO_CHAR(NTC_START, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
			OR TO_CHAR(NTC_END, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM'))
</select>

<!-- 전사일정 상세조회 -->
<select id="ntcScheduleDetail" parameterType="java.lang.String" resultType="NtcVo">
	SELECT NTC_SEQ, USER_ID, NTC_TITLE, 
                NTC_CONTENT, NTC_START, NTC_END, 
                NTC_CREATE,NTC_DELFLAG     
        FROM NTC_SCHEDULE
        WHERE NTC_SEQ = #{ntc_seq}
</select>

</mapper>


