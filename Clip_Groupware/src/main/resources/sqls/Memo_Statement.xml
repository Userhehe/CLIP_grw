<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.clip.gwr.model.mapper.MemoDaoImpl" >

<!-- 본인 메모 조회 -->
<select id="myScheduleAll" parameterType="java.lang.String" resultType="MemoVo">
	SELECT PRS_SEQ, USER_ID, PRS_TITLE, 
       	   PRS_CONTENT, PRS_START, PRS_END, 
           PRS_CREATE, PRS_DELFLAG
        FROM USER_SCHEDULE
        WHERE USER_ID = #{user_id} AND PRS_DELFLAG = 'N'
        AND (PRS_START BETWEEN TO_DATE('2024-03-04', 'YYYY-MM-DD') AND TO_DATE('2024-03-28', 'YYYY-MM-DD')
        OR PRS_END BETWEEN TO_DATE('2024-03-04', 'YYYY-MM-DD') AND TO_DATE('2024-03-29', 'YYYY-MM-DD'))
</select >

<!-- 선택메모 상세조회 -->
<select id="myScheduleDetail" parameterType="java.lang.String" resultType="MemoVo">
	SELECT PRS_SEQ, USER_ID, PRS_TITLE, 
       	   PRS_CONTENT, PRS_START, PRS_END, 
           PRS_CREATE, PRS_DELFLAG    
        FROM USER_SCHEDULE
        WHERE PRS_SEQ = #{prs_seq} 
        AND PRS_DELFLAG = 'N'
</select>

<!-- 메모 입력 -->
<insert id="myScheduleInsert" parameterType="MemoVo" >
	INSERT INTO USER_SCHEDULE(PRS_SEQ, USER_ID, PRS_TITLE, 
                              PRS_CONTENT, PRS_START, PRS_END, 
                              PRS_CREATE)
        VALUES('USERSCHEDULE_' || TO_CHAR(USERSCHEDULE_SEQ.NEXTVAL, 'FM000'), #{user_id}, #{prs_title}, 
               #{prs_content}, TO_DATE('2024-01-22T15:30:15', 'YYYY-MM-DD"T"HH24:MI:SS'), TO_DATE('2024-02-01T15:30:15', 'YYYY-MM-DD"T"HH24:MI:SS'), 
               TO_DATE(SYSDATE, 'YYYY-MM-DD"T"HH24:MI:SS'))
</insert>

<!-- 개인 메모 수정 -->
<update id="myScheduleUpdate" parameterType="MemoVo">
	UPDATE USER_SCHEDULE
		SET PRS_TITLE=#{prs_title}, PRS_CONTENT=#{prs_content}, PRS_START=TO_DATE('2024-02-24T15:30:15', 'YYYY-MM-DD"T"HH24:MI:SS'), PRS_END=TO_DATE('2024-02-25T15:30:15', 'YYYY-MM-DD"T"HH24:MI:SS'), PRS_CREATE=SYSDATE
		WHERE PRS_SEQ=#{prs_seq} AND USER_ID = #{user_id}
</update>

<!-- 개인 메모 삭제 -->
<delete id="myScheduleDelete" parameterType="java.lang.String">
	DELETE FROM USER_SCHEDULE
		WHERE PRS_SEQ=#{prs_seq} AND USER_ID = #{user_id}
</delete>


<!-- 테스트 용 유니온으로 하는 전사, 개인 일정 조회 -->
<select id="selectScheduleAll" parameterType="java.util.Map" resultType="MemoVo">
	SELECT PRS_SEQ , USER_ID, PRS_TITLE, 
			TO_CHAR(PRS_START, 'YYYY-MM-DD HH24:MI') AS PRS_START, TO_CHAR(PRS_END, 'YYYY-MM-DD HH24:MI') AS PRS_END
			FROM USER_SCHEDULE
			WHERE PRS_DELFLAG = 'N' AND USER_ID = #{user_id}
			AND TO_CHAR(PRS_START, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
			OR TO_CHAR(PRS_END, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
	UNION 
	SELECT NTC_SEQ, USER_ID, NTC_TITLE, 
			TO_CHAR(NTC_START, 'YYYY-MM-DD HH24:MI') AS NTC_START, TO_CHAR(NTC_END, 'YYYY-MM-DD HH24:MI') AS NTC_END
	        FROM NTC_SCHEDULE
	        WHERE NTC_DELFLAG = 'N'
	       	AND TO_CHAR(NTC_START, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
			OR TO_CHAR(NTC_END, 'YYYY-MM') = TO_CHAR(TO_DATE(#{fullDate}, 'YYYY-MM'), 'YYYY-MM')
</select>


</mapper>


